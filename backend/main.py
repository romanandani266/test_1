Full FastAPI code as described above